<div class="container">
  <div class="col-xs-6">
    <div id="pusher-key" style="display:none;"><%= Pusher.key %></div>
		<h4><%= @question.content %></h4>
		<% if @question.choices.any? %>
		  <% @question.choices.each do |choice| %>
		  	<%= div_for choice do %>
		    	<span id="label1"><%= choice.content %></span>
		    	<%= link_to 'Delete Choice', choice, method: :delete %>
		    	<p class='vote-count'>
		    		<% if choice.votes.any? %>
			    		Votes: <%= choice.votes.count %>
			    	<% end %>
		    	</p>
		  	<% end %>
		  <% end %>

      <span id="labels"><%= @labelscommas.to_s %></span>
      <span id="data"><%= @datacommas.to_s %></span>

<!-- CHARTS -->

      <div style="width: 50%">
        <canvas id="canvas" height="450" width="600"></canvas>
      </div>

		  <% if any_votes? @question %>
		  	<%= link_to 'Clear Votes', clear_votes_path %>
		  <% end %>
		<% end %>

		<%= link_to 'Add Choice', new_question_choice_path(@question), class: 'form-control btn btn-info btn-fill' %>
		<%= link_to "Back to #{@question.event.title}", event_path(@question.event.id), class: 'form-control btn btn-info btn-fill' %>
  </div>
</div>


<script>
  function buildGraph(data) {
    var choiceOne = data.choices[0].content
    return choiceOne;
  }

  var choiceLabels = $('#labels').text().split(',').slice(0, -1)
  var voteCounts = $('#data').text().split(',').slice(0, -1)



  var barChartData = {
    labels : choiceLabels,
    datasets : [
      {
        fillColor : "rgba(220,220,220,0.5)",
        strokeColor : "rgba(220,220,220,0.8)",
        highlightFill: "rgba(220,220,220,0.75)",
        highlightStroke: "rgba(220,220,220,1)",
        data : voteCounts
      }
    ]

  }
  window.onload = function(){
    var ctx = document.getElementById("canvas").getContext("2d");
    window.myBar = new Chart(ctx).Bar(barChartData, {
      responsive : true
    });
  }

</script>
